<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<html>
  <head>
    <title>Relationship Graph</title>
    <style>

    </style>
    
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>  

  </head>
  
  
  <body>
<div id="graphview"></div>

    <script type="text/javascript">

let width = window.innerWidth * 0.5
let height = window.innerWidth * 0.5
let svg = d3.select("#graphview")
    .append('svg')
    .attr('width', width)
    .attr('height', height)

d3.csv("https://raw.githubusercontent.com/Do7and/VisHomework2/main/nodes.csv",function (nodes) {
d3.csv("https://raw.githubusercontent.com/Do7and/VisHomework2/main/edges.csv",function (edges) {
//准备数据


//设置一个color的颜色比例尺，为了让不同的点呈现不同的颜色
let colorScale = d3.scaleOrdinal()
    .domain(d3.range(nodes.length))
    .range(d3.schemeCategory10);

// 新建一个力导图
let simulation = d3.forceSimulation(nodes)
    .velocityDecay(0.6)
    .force("link", d3.forceLink(edges).distance(50))//可以更改distance数值设置边的距离
    .force("charge", d3.forceManyBody().strength(-30))
    .force("centering", d3.forceCenter().x(width /2).y(height / 2))//布局中心
    .force('collide', d3.forceCollide().radius(60).iterations(2))
    .on('tick', ticked)
    // .alphaTarget(0.5)
    .alphaMin(0.2);

//绘制节点
node = svg.append("g")
    .selectAll('circle')
    .data(nodes)
    .join('circle')
    .attr("r", 10)
    .attr("fill", function (d, i) {
        return colorScale(i);
    })
    .call(d3.drag()
        .on("start", started)
        .on("drag", dragged)
        .on("end", ended)
    );

//文字
node.append("title")
    .text(function (d) {
        return d.name
    });

//绘制边
let links = svg.append("g")
    .attr('id', 'lines')
    .attr("stroke-opacity", 0.6)
    .selectAll("line")
    .data(edges)
    .join('line')
    .attr("stroke", function (d, i) {
        return colorScale(i);
    })
    .attr("stroke-width", 1);


//边上的文字
let linksText = svg.append("g")
    .selectAll("text")
    .data(edges)
    .enter()
    .append("text")
    .text(function (d) {
        return d.relation;
    })

//ticked 函数的实现
function ticked() {
    //更新连线的位置
    links
        .attr("x1", function (d) { return d.source.x; })
        .attr("y1", function (d) { return d.source.y; })
        .attr("x2", function (d) { return d.target.x; })
        .attr("y2", function (d) { return d.target.y; });

    node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y)

    //更新边上文字的位置
    linksText
        .attr("x", function (d) {
            return (d.source.x + d.target.x) / 2;
        })
        .attr("y", function (d) {
            return (d.source.y + d.target.y) / 2;
        });

}

function started(event, d) {
    if (!event.active) {
        simulation.alphaTarget(0.8).restart(); //设置衰减系数，对节点位置移动过程的模拟，数值越高移动越快，数值范围[0，1]
    }
    d.fx = d.x;
    d.fy = d.y;
}
function dragged(event, d) {
    d.fx = event.x;
    d.fy = event.y;
}
function ended(event, d) {
    if (!event.active) {
        simulation.alphaTarget(0);
    }
    d.fx = null;
    d.fy = null;
}
}
}
   </script>
  </body>
</html>